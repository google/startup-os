<div *ngIf="diff" class="single-review">
  
  <!-- Title bar -->
  <review-titlebar 
    [diff]="diff"
    [editable]="editable"
    (onAddToAttentionList)="saveAttentionList($event)"
    >
  </review-titlebar>

  <!-- Details of the review -->
  <div class="review-details">
    
    <div fxLayout="row" fxLayoutGap="10%">
      <div fxLayout="column" fxLayoutGap="20px" fxFlex="45%">
  
        <!-- Person List based on Reviewer in the Diff -->
        <div>
          <app-person-list 
            [diff]="diff"
            [property]="'reviewers'"
            [enableAddToAttention]="true"
            [editable]="editable"
            (onUpdateDiff)="updateDiff($event, 'Reviewers Updated')"
            (onRemove)="removeProperty($event, 'Reviewers Updated')"
            (onAddToAttentionList)="saveAttentionList($event)"
            ></app-person-list>
        </div>
  
        <!-- Person List based on CC in the Diff -->
        <div>
          <app-person-list 
            [diff]="diff"
            [property]="'cc'"
            [editable]="editable"
            [enableAddToAttention]="false"
            (onUpdateDiff)="updateDiff($event, 'CC Updated')"
            (onRemove)="removeProperty($event, 'CC Updated')"
            ></app-person-list>
        </div>
  
        <!-- Bug property of Diff that is a link to related Github Issue -->
        <div>
          <app-editable-property
          [diff]="diff"
          [property]="'bug'"
          [editable]="editable"
          (onUpdateDiff)="updateDiff($event, 'Bug Updated')"
          ></app-editable-property>
        </div>
  
        <!-- Created At timestamp -->
        <div fxLayout="row" 
          fxLayout.xs="column" 
          fxLayoutGap.xs="10px">
          <div fxFlex="150px" fxFlex.xs=""
            fxFlexAlign="center" 
            class="property">
            Created:
          </div>
          <div fxFlex class="timestamp">
            {{ diff.createdTimestamp | date:'medium' }}
          </div>
        </div>
  
        <!-- Modified timestamp -->
        <div fxLayout="row" 
          fxLayout.xs="column" 
          fxLayoutGap.xs="10px">
          <div fxFlex="150px" fxFlex.xs="" 
            fxFlexAlign="center"
            class="property">
            Modified:
          </div>
          <div fxFlex 
            class="timestamp">
            {{ diff.modifiedTimestamp | date:'medium' }}
          </div>
        </div>

        
      </div>

      <div fxFlex="45%">
        <!-- Review Description -->
        <div>
          <app-editable-property
            [diff]="diff"
            [property]="'description'"
            [editable]="editable"
            (onUpdateDiff)="updateDiff($event, 'Description Updated')"
          ></app-editable-property>
        </div>
      </div>

    </div>
  </div>

  <!-- Files -->
  <div>
    <div fxLayout="column" fxLayoutAlign="space-around stretch">
      <div class="review-title">
        Files
      </div>
      <div class="review-sub-title">
        <div fxFlex="60%">
          File
        </div>
        <div fxFlex="13%" fxFlex.xs="">
          Comments
        </div>
        <div fxFlex="13%" fxFlex.xs="">
          Modified
        </div>
        <div fxFlex="13%" fxFlex.xs="">
          Delta
        </div>
      </div>
    </div>
    <div class="files-info-container">
      <div fxLayout="row" 
        fxLayout.xs="column" 
        fxLayoutGap.xs="10px"
        *ngFor="let file of diff.files; let i = index"
        class="file-info">
        <div fxFlex fxLayout="row">
          <div fxFlex="60%">
            <a class="link" 
              (click)="openFile(file.filePosition)"> 
              {{ file.filePosition }}
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Review Comments -->
  <div>
    <div fxLayout="column" fxLayoutAlign="space-around stretch">
      <div class="review-title">
        Discussion
      </div>
      <div class="review-sub-title bold-text">
        General discussions (
          {{ getTotalComments() }} comments, 
          {{ getUnresolvedComments() }} unresolved)
      </div>
    </div>
    <div class="expanded-thread" 	     
      fxLayout="column" 	       
      fxLayout.xs="column" 	       
      fxLayoutGap.xs="10px" 	        
      *ngFor="let thread of diff.threads; let i = index">	       
      <div fxLayout="row" class="thread-header">     
        <div fxFlex="50%" class="detail">         
          {{ thread.filename }}	      
        </div>	         
        <div fxFlex="10%" class="line-number-label">	    
          {{ thread.comments.length }} comments
        </div>	
        <!-- <div fxFlex="10%" class=""> 	
          {{ thread.snapshot }}	
        </div>	 -->
        <div fxFlex="100px" class="line-number-label">	
          Line number:	
        </div>	
        <div fxFlex="10%" class=""> 	
          {{ thread.lineNumber }}	
        </div>	
      </div>	      
      <div *ngFor="let comment of thread.comments" 	
        class="thread-contents">	
        <div class="comment">	
          <div class="content"> 	
            {{ comment.content }} 	
          </div> 	
          <div fxLayout="row" 	
            fxLayoutGap="5px" 	
            class="details">	
            <div> 	
              <span> by </span>	
              {{ comment.createdBy }} 	
            </div>	
            <div> 	
              <span> on </span> 	
              {{ comment.timestamp |  	
                date:'MMM dd, yyyy HH:mm a' : timezone }}	
            </div>	
          </div>
        </div>
      </div>
    </div>
  </div>
  
</div>
